<div class="card shadow-sm border-0 rounded-4 p-3 bg-white" dir="rtl">
  <div
    class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 gap-2">
    <div class="text-center text-md-start">
      <h5 class="fw-bold mb-1 text-dark">الخطابات المعلقة</h5>
      <p class="text-muted small mb-0">خطابات تحتاج إلى مراجعتك وموافقتك</p>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table align-middle mb-0 text-center" dir="rtl">
      <thead class="bg-light">
        <tr>
          <th class="fw-semibold text-dark border-0 px-2">العنوان</th>
          <th class="fw-semibold text-dark border-0 d-none d-md-table-cell">نوع القرار</th>
          <th class="fw-semibold text-dark border-0">تاريخ الإنشاء</th>
          <th class="fw-semibold text-dark border-0">الحالة</th>
          <th class="fw-semibold text-dark border-0">الإجراءات</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of pendingList" class="border-bottom">
          <td class="py-3 px-2">
            <div class="d-flex align-items-center justify-content-center gap-2" dir="rtl">
              <i class="bi bi-file-text text-primary flex-shrink-0"></i>
              <span class="fw-medium text-truncate" [title]="item.title">{{ item.title }}</span>
            </div>
          </td>
          <td class="py-3 d-none d-md-table-cell">
            <span class="badge bg-secondary bg-opacity-10 text-dark rounded-pill px-3 py-2 border">
              {{ item.decision?.title || 'غير محدد' }}
            </span>
          </td>
          <td class="py-3">
            <div class="d-flex align-items-center justify-content-center gap-2" dir="rtl">
              <i class="bi bi-calendar3 text-muted small flex-shrink-0"></i>
              <span class="text-muted small">{{ item.date | date: 'd MMMM y' : '' : 'ar-EG' }}</span>
            </div>
          </td>
          <td class="py-3">
            <span class="badge rounded-pill px-3 py-2 fw-medium border-0" [ngClass]="{
              'bg-primary text-white': item.status === 'in_progress',
              'bg-warning text-dark': item.status === 'pending',
              'bg-success text-white': item.status === 'approved',
              'bg-danger text-white': item.status === 'rejected'
            }">
              <i class="bi me-1" [ngClass]="{
                'bi-clock-history': item.status === 'in_progress',
                'bi-hourglass-split': item.status === 'pending',
                'bi-check-circle': item.status === 'approved',
                'bi-x-circle': item.status === 'rejected'
              }"></i>
              <span>
                {{
                item.status === 'in_progress' ? 'قيد المراجعة' :
                item.status === 'pending' ? 'معلق' :
                item.status === 'approved' ? 'تمت الموافقة' :
                item.status === 'rejected' ? 'مرفوض' : 'غير معروف'
                }}
              </span>
            </span>
          </td>
          <td class="py-3">
            <button
              class="btn btn-sm btn-outline-dark rounded-3 d-flex align-items-center justify-content-center gap-2 px-3"
              (click)="open(item._id)" dir="rtl">
              مراجعة
            </button>
          </td>
        </tr>
        <tr *ngIf="pendingList.length === 0">
          <td colspan="5" class="text-center py-5" dir="rtl">
            <div class="d-flex flex-column align-items-center justify-content-center text-muted">
              <i class="bi bi-inbox display-4 mb-3 opacity-50"></i>
              <p class="mb-2 fw-medium">لا توجد خطابات معلقة حالياً</p>
              <small class="text-muted">سيظهر هنا الخطابات التي تحتاج إلى مراجعتك</small>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div class="modal fade show d-block" [class.show]="selectedLetter" tabindex="-1" *ngIf="selectedLetter">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" dir="rtl">
    <div class="modal-content border-0 rounded-4 shadow-lg">
      <!-- Modal Header -->
      <div class="modal-header bg-gradient bg-dark text-white rounded-4 rounded-bottom-0 border-0 py-4" dir="rtl">
        <div class="d-flex align-items-center gap-3 w-100">
          <i class="bi bi-file-text display-6 flex-shrink-0"></i>
          <div class="flex-grow-1 min-w-0">
            <h5 class="modal-title fw-bold mb-1 text-truncate">{{ selectedLetter.title }}</h5>
            <div class="d-flex flex-wrap gap-2 align-items-center mt-2">
              <small
                class="badge bg-light bg-opacity-20 text-white rounded-pill px-3 py-1 d-flex align-items-center gap-1">
                <i class="bi bi-calendar3"></i>
                <span>{{ selectedLetter.date | date: 'd MMMM y' : '' : 'ar-EG' }}</span>
              </small>
              <small
                class="badge bg-light bg-opacity-20 text-white rounded-pill px-3 py-1 d-flex align-items-center gap-1">
                <i class="bi bi-tag"></i>
                <span>{{ selectedLetter.decision?.title || 'غير محدد' }}</span>
              </small>
            </div>
          </div>
          <button type="button"
            class="btn-close btn-close-white bg-white bg-opacity-20 rounded-circle p-2 flex-shrink-0 ms-0 me-auto"
            (click)="closeModal()"></button>
        </div>
      </div>

      <!-- Modal Body -->
      <div class="modal-body py-4" dir="rtl">
        <div class="row g-3 mb-4">
          <div class="col-12 col-sm-6">
            <div class="bg-light rounded-3 p-3 border">
              <small class="text-muted d-block mb-1">الحالة الحالية</small>
              <span class="badge rounded-pill px-3 py-2 fw-medium border-0" [ngClass]="{
                'bg-primary text-white': selectedLetter.status === 'in_progress',
                'bg-warning text-dark': selectedLetter.status === 'pending',
                'bg-success text-white': selectedLetter.status === 'approved',
                'bg-danger text-white': selectedLetter.status === 'rejected'
              }">
                {{ getStatusText(selectedLetter.status) }}
              </span>
            </div>
          </div>
          <div class="col-12 col-sm-6">
            <div class="bg-light rounded-3 p-3 border">
              <small class="text-muted d-block mb-1">آخر تحديث</small>
              <span class="fw-medium">{{ (selectedLetter.updatedAt || selectedLetter.date) | date: 'short' : '' :
                'ar-EG' }}</span>
            </div>
          </div>
        </div>

        <h6 class="fw-bold mb-3 text-dark border-bottom pb-2 d-flex align-items-center gap-2">
          <i class="bi bi-card-text"></i>
          <span>محتوى الخطاب</span>
        </h6>

        <div class="p-3 p-md-4 bg-light rounded-3 border" [innerHTML]="safeDescription" dir="rtl"></div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer border-0 bg-light rounded-4 rounded-top-0 py-3" dir="rtl">
        <div class="d-flex flex-column flex-sm-row w-100 gap-2 justify-content-between">
          <button
            class="btn btn-outline-secondary rounded-3 d-flex align-items-center gap-2 order-2 order-sm-1 flex-grow-1 flex-sm-grow-0 justify-content-center"
            (click)="closeModal()">
            <i class="bi bi-x-circle"></i>
            <span>إغلاق</span>
          </button>
          <div class="d-flex gap-2 order-1 order-sm-2 w-100 w-sm-auto justify-content-center justify-content-sm-end">
            <button
              class="btn btn-success rounded-3 d-flex align-items-center gap-2 px-3 px-sm-4 flex-grow-1 flex-sm-grow-0 justify-content-center">
              <i class="bi bi-check-lg"></i>
              <span>اعتماد الخطاب</span>
            </button>
            <button
              class="btn btn-outline-danger rounded-3 d-flex align-items-center gap-2 flex-grow-1 flex-sm-grow-0 justify-content-center">
              <i class="bi bi-x-lg"></i>
              <span>رفض</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Backdrop -->
<div class="modal-backdrop fade show" *ngIf="selectedLetter"></div>