<div class="card shadow-sm border-0 rounded-4 p-3 bg-white" dir="rtl">
  <div
    class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 gap-2">
    <div class="text-center text-md-start">
      <h5 class="fw-bold mb-1 text-dark">الخطابات المعلقة</h5>
      <p class="text-muted small mb-0">خطابات تحتاج إلى مراجعتك وموافقتك</p>
    </div>

    <div class="dropdown position-relative">
      <button class="btn btn-outline-secondary d-flex align-items-center gap-2" type="button" (click)="toggleDropdown()"
        dir="rtl">
        <i class="bi bi-funnel"></i>
        تصفية حسب الحالة
        <i class="bi bi-chevron-down small" [class.rotate-180]="isDropdownOpen"></i>
      </button>

      <div class="dropdown-menu-custom shadow border-0 rounded-3" [class.show]="isDropdownOpen" dir="rtl">
        <button class="dropdown-item-custom d-flex align-items-center gap-2 py-2" (click)="filterByStatus('all')">
          <i class="bi bi-list-ul text-muted"></i>
          جميع الخطابات
        </button>
        <div class="dropdown-divider-custom"></div>
        <button class="dropdown-item-custom d-flex align-items-center gap-2 py-2"
          (click)="filterByStatus('in_progress')">
          <i class="bi bi-clock-history text-primary"></i>
          قيد المراجعة
        </button>
        <button class="dropdown-item-custom d-flex align-items-center gap-2 py-2" (click)="filterByStatus('pending')">
          <i class="bi bi-hourglass-split text-warning"></i>
          معلق
        </button>
        <button class="dropdown-item-custom d-flex align-items-center gap-2 py-2" (click)="filterByStatus('approved')">
          <i class="bi bi-check-circle text-success"></i>
          تمت الموافقة
        </button>
      </div>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table align-middle mb-0 text-center" dir="rtl">
      <thead class="bg-light">
        <tr>
          <th class="fw-semibold text-dark border-0 px-2" style="width: 60px;">#</th>
          <th class="fw-semibold text-dark border-0 px-2">العنوان</th>
          <th class="fw-semibold text-dark border-0 d-none d-md-table-cell">نوع القرار</th>
          <th class="fw-semibold text-dark border-0">تاريخ الإنشاء</th>
          <th class="fw-semibold text-dark border-0">الحالة</th>
          <th class="fw-semibold text-dark border-0">الإجراءات</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of filteredList; let i = index" class="border-bottom">
          <td class="py-3 px-2">
            <span class="fw-medium text-muted">{{ i + 1 }}</span>
          </td>
          <td class="py-3 px-2">
            <div class="title-container" dir="rtl">
              <i class="bi bi-file-text text-primary flex-shrink-0"></i>
              <span class="title-text fw-medium" [title]="item.title">{{ item.title }}</span>
            </div>
          </td>
          <td class="py-3 d-none d-md-table-cell">
            <span class="badge bg-secondary bg-opacity-10 text-dark rounded-pill px-3 py-2 border">
              {{ item.decision.title || 'غير محدد' }}
            </span>
          </td>
          <td class="py-3">
            <div class="d-flex align-items-center justify-content-center gap-2" dir="rtl">
              <i class="bi bi-calendar3 text-muted small flex-shrink-0"></i>
              <span class="text-muted small">{{ item.date | date: 'd MMMM y' : '' : 'ar-EG' }}</span>
            </div>
          </td>
          <td class="py-3">
            <span class="badge rounded-pill px-3 py-2 fw-medium border-0" [ngClass]="{
              'bg-primary text-white': item.status === 'in_progress',
              'bg-warning text-dark': item.status === 'pending',
              'bg-success text-white': item.status === 'approved',
            }">
              <i class="bi me-1" [ngClass]="{
                'bi-clock-history': item.status === 'in_progress',
                'bi-hourglass-split': item.status === 'pending',
                'bi-check-circle': item.status === 'approved',
              }"></i>
              <span>
                {{
                item.status === 'in_progress' ? 'قيد المراجعة' :
                item.status === 'pending' ? 'معلق' :
                item.status === 'approved' ? 'تمت الموافقة' :
                'غير معروف'
                }}
              </span>
            </span>
          </td>
          <td class="py-3">
            <button
              class="btn btn-sm btn-outline-dark rounded-3 d-flex align-items-center justify-content-center gap-2 px-3"
              (click)="open(item._id)" dir="rtl">
              مراجعة
            </button>
          </td>
        </tr>
        <tr *ngIf="filteredList.length === 0">
          <td colspan="6" class="text-center py-5" dir="rtl">
            <div class="d-flex flex-column align-items-center justify-content-center text-muted">
              <i class="bi bi-inbox display-4 mb-3 opacity-50"></i>
              <p class="mb-2 fw-medium">لا توجد خطابات لعرضها</p>
              <small class="text-muted" *ngIf="selectedStatus !== 'all'">
                لا توجد خطابات بحالة "{{ getStatusText(selectedStatus) }}"
              </small>
              <small class="text-muted" *ngIf="selectedStatus === 'all'">
                لا توجد خطابات لعرضها حالياً
              </small>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>