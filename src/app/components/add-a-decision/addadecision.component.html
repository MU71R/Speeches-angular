<!-- Loading Spinner -->
<div class="loading-container" *ngIf="loading">
  <div class="loading-spinner">
    <div class="loading-spinner-inner">
      <div class="loading-spinner-inner-inner"></div>
    </div>
  </div>
</div>

<!-- محتوى الصفحة -->
<div class="container-fluid" dir="rtl" [class.blur-content]="loading">
  <!-- رأس الصفحة + زر الإضافة -->
  <div class="d-flex justify-content-between align-items-center mb-4 mt-3 page-header">
    <h2 class="fw-bold m-0 page-title">إدارة أنواع القرارات</h2>
    <button class="btn btn-primary add-btn" (click)="openFormModal()">
      <i class="fas fa-plus-circle me-2"></i>إضافة نوع قرار
    </button>
  </div>

  <!-- Modal Add/Edit -->
  <div *ngIf="showFormModal" class="modal fade show d-block modal-backdrop-custom">
    <div class="modal-dialog responsive-modal">
      <div class="modal-content d-flex flex-column gap-3">

        <!-- Header -->
        <div class="modal-header">
          <h5 class="modal-title text-end">{{ editingId ? 'تعديل نوع القرار' : 'إضافة نوع قرار جديد' }}</h5>
          <button type="button" class="btn-close" (click)="closeFormModal()" title="إغلاق"></button>
        </div>

        <!-- Body -->
        <div class="modal-body d-flex flex-column gap-3">
          <label>نوع القرار:</label>
          <input class="form-control" placeholder="نوع القرار" [(ngModel)]="form.title" />

          <label>القطاع:</label>
          <select class="form-select" [(ngModel)]="form.sector" (change)="onSectorChange($event)">
            <option value="" disabled>اختر القطاع</option>
            <option *ngFor="let s of sectors" [value]="s._id">{{ s.sector }}</option>
          </select>

          <label>جهة المراجعة:</label>
          <select class="form-select" [(ngModel)]="form.supervisor">
            <option value="" disabled>اختر جهة المراجعة</option>
            <option *ngFor="let u of reviewers" [value]="u._id">{{ u.fullname }}</option>
          </select>

          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" [(ngModel)]="form.isPresidentDecision"
              id="presidentSignature">
            <label class="form-check-label" for="presidentSignature">يتطلب توقيع الرئيس</label>
          </div>
        </div>

        <!-- Footer -->
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeFormModal()">إلغاء</button>
          <button class="btn btn-primary" (click)="saveDecisionType()">{{ editingId ? 'تحديث' : 'حفظ' }}</button>
        </div>

      </div>
    </div>
  </div>

  <!-- Table View Decisions -->
  <div class="table-responsive shadow-sm rounded bg-white mt-4 decisions-table">
    <table class="table table-hover text-center align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th class="decision-type">نوع القرار</th>
          <th class="sector">القطاع</th>
          <th class="supervisor">جهة المراجعة</th>
          <th class="president-signature">صادر من رئيس الجامعه</th>
          <th class="actions">الإجراءات</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let d of decisions">
          <td class="decision-type">{{ d.title }}</td>
          <td class="sector">{{ d.sector?.sector || '—' }}</td>
          <td class="supervisor">{{ d.supervisor?.fullname || '—' }}</td>
          <td class="president-signature">
            <i class="fas"
              [ngClass]="d.isPresidentDecision ? 'fa-check-circle text-success' : 'fa-times-circle text-secondary'"></i>
          </td>
          <td class="actions">
            <div class="d-flex justify-content-center gap-2 action-buttons">
              <button class="btn btn-sm btn-danger" (click)="deleteDecisionType(d._id)">
                <i class="fas fa-trash"></i>
              </button>
              <button class="btn btn-sm btn-primary" (click)="editDecisionType(d)">
                <i class="fas fa-edit"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="decisions.length === 0" class="text-center py-3 text-muted">
      لا يوجد أنواع قرارات لعرضها
    </div>
  </div>
</div>